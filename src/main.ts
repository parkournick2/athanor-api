import { AppModule } from './app.module'
import { CORS_WHITELIST } from './constants/cors'
import { ValidationPipe } from '@nestjs/common'
import { NestFactory } from '@nestjs/core'
import * as dotenv from 'dotenv'

dotenv.config()

const bootstrap = async () => {
  const PORT = process.env.PORT || 4000

  const app = await NestFactory.create(AppModule)

  app.enableCors({
    origin: function (origin, callback) {
      if (
        !origin ||
        CORS_WHITELIST.indexOf(origin) !== -1 ||
        (process.env.NODE_ENV || 'development') === 'development'
      ) {
        callback(null, true)
      } else {
        callback(new Error('Not allowed by CORS'))
      }
    },
  })

  // Pipes
  app.useGlobalPipes(
    new ValidationPipe({
      transform: true,
      whitelist: true,
      forbidNonWhitelisted: true,
    }),
  )

  await app.listen(PORT)

  console.log(`
   РќѕРќѕРќѕРќѕРќѕРЋЌ РќѕРќѕРќѕРќѕРќѕРќѕРќѕРќѕРЋЌРќѕРќѕРЋЌ  РќѕРќѕРЋЌ РќѕРќѕРќѕРќѕРќѕРЋЌ РќѕРќѕРќѕРЋЌ   РќѕРќѕРЋЌ РќѕРќѕРќѕРќѕРќѕРќѕРЋЌ РќѕРќѕРќѕРќѕРќѕРќѕРЋЌ 
  РќѕРќѕРЋћРЋљРЋљРќѕРќѕРЋЌРЋџРЋљРЋљРќѕРќѕРЋћРЋљРЋљРЋЮРќѕРќѕРЋЉ  РќѕРќѕРЋЉРќѕРќѕРЋћРЋљРЋљРќѕРќѕРЋЌРќѕРќѕРќѕРќѕРЋЌ  РќѕРќѕРЋЉРќѕРќѕРЋћРЋљРЋљРЋљРќѕРќѕРЋЌРќѕРќѕРЋћРЋљРЋљРќѕРќѕРЋЌ
  РќѕРќѕРќѕРќѕРќѕРќѕРќѕРЋЉ   РќѕРќѕРЋЉ   РќѕРќѕРќѕРќѕРќѕРќѕРќѕРЋЉРќѕРќѕРќѕРќѕРќѕРќѕРќѕРЋЉРќѕРќѕРЋћРќѕРќѕРЋЌ РќѕРќѕРЋЉРќѕРќѕРЋЉ   РќѕРќѕРЋЉРќѕРќѕРќѕРќѕРќѕРќѕРЋћРЋЮ
  РќѕРќѕРЋћРЋљРЋљРќѕРќѕРЋЉ   РќѕРќѕРЋЉ   РќѕРќѕРЋћРЋљРЋљРќѕРќѕРЋЉРќѕРќѕРЋћРЋљРЋљРќѕРќѕРЋЉРќѕРќѕРЋЉРЋџРќѕРќѕРЋЌРќѕРќѕРЋЉРќѕРќѕРЋЉ   РќѕРќѕРЋЉРќѕРќѕРЋћРЋљРЋљРќѕРќѕРЋЌ
  РќѕРќѕРЋЉ  РќѕРќѕРЋЉ   РќѕРќѕРЋЉ   РќѕРќѕРЋЉ  РќѕРќѕРЋЉРќѕРќѕРЋЉ  РќѕРќѕРЋЉРќѕРќѕРЋЉ РЋџРќѕРќѕРќѕРќѕРЋЉРЋџРќѕРќѕРќѕРќѕРќѕРќѕРЋћРЋЮРќѕРќѕРЋЉ  РќѕРќѕРЋЉ
  РЋџРЋљРЋЮ  РЋџРЋљРЋЮ   РЋџРЋљРЋЮ   РЋџРЋљРЋЮ  РЋџРЋљРЋЮРЋџРЋљРЋЮ  РЋџРЋљРЋЮРЋџРЋљРЋЮ  РЋџРЋљРЋљРЋљРЋЮ РЋџРЋљРЋљРЋљРЋљРЋљРЋЮ РЋџРЋљРЋЮ  РЋџРЋљРЋЮ
   РађРађРађРађРађРађРађРађРађРађРађРБђРБђРБцРБцРБцРБцРА╝РађРбђРАђРБђРб▒РАёРАђРађРађРађРб▓РБцРБцРБцРБцРБђРБђРАђРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРађРађРађРађРађРађРБаРБ┤РБЙРБ┐РБ┐РБ┐РБ┐РБ┐РА┐РаЏРаІРаЂРБцРБ┐РБ┐РБ┐РБДРБиРађРађРаўРаЅРаЏРб╗РБиРБ┐РБйРБ┐РБ┐РБиРБдРБёРАђРађРађРађРађРађРађРађРађ
РађРађРађРађРађРађРбђРБ┤РБъРБйРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РаЂРађРађРааРБ┐РБ┐РАЪРб╗РБ┐РБ┐РБЄРађРађРађРађРађРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБЪРбдРАђРађРађРађРађРађРађ
РађРађРађРађРађРБаРБ┐РАЙРБ┐РБ┐РБ┐РБ┐РБ┐Ра┐РБ╗РБ┐РБ┐РАђРађРађРађРб╗РБ┐РБиРАђРа╗РБДРБ┐РаєРађРађРађРађРБ┐РБ┐РБ┐РА╗РБ┐РБ┐РБ┐РБ┐РБ┐Ра┐РБйРБдРАђРађРађРађРађ
РађРађРађРађРБ╝РаЪРБЕРБЙРБ┐РБ┐РБ┐РбЪРБхРБЙРБ┐РБ┐РБ┐РБДРађРађРађРаѕРа┐РБ┐РБ┐РБиРБѕРаЂРађРађРађРађРБ░РБ┐РБ┐РБ┐РБ┐РБ«РБЪРб»РБ┐РБ┐РБиРБгРА╗РБиРАёРађРађРађ
РађРађРбђРАюРБАРБЙРБ┐Рб┐РБ┐РБ┐РБ┐РБ┐РБ┐РбЪРБхРБ┐РБ┐РБ┐РБиРБёРађРБ░РБ┐РБ┐РБ┐РБ┐РБ┐РБиРБёРађРбђРБ╝РБ┐РБ┐РБ┐РБиРА╣РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐Рб┐РБ┐РБ«РА│РАёРађРађ
РађРбаРбЪРБ┐РА┐РаІРБаРБЙРб┐РБ┐РБ┐РаЪРбЃРБЙРбЪРБ┐Рб┐РБ┐РБ┐РБ┐РБЙРА┐РаЪРа╗РБ┐РБ╗РБ┐РБЈРа╗РБ┐РБЙРБ┐РБ┐РБ┐РБ┐РАЏРБ┐РАїРа╗РБ┐РБ┐РА┐РБ┐РБдРАЎРб┐РБ┐РАЮРБєРађ
РађРб»РБ┐РаЈРБаРаъРаІРађРБаРА┐РаІРбђРБ┐РаЂРбИРАЈРБ┐Ра┐РБ┐РБ┐РаЃРбаРБ┤РБЙРБ┐РБ┐РБ┐РАЪРађРаўРб╣РБ┐РаЪРБ┐РБЙРБиРаѕРБ┐РАёРаўРб┐РБдРађРаѕРа╗РБєРаЎРБ┐РБюРає
РбђРБ┐РаЃРА┤РаЃРбђРАаРаъРаІРађРађРа╝РаІРађРаИРАЄРа╗РађРаѕРаЃРађРБДРбІРБ╝РБ┐РБ┐РБ┐РБиРБєРађРаѕРаЂРађРаЪРаЂРАЪРађРаѕРа╗РађРађРаЅРа│РбдРАђРаѕРбБРаѕРб┐РАё
РБИРаЄРбаРБиРаъРаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаЎРа╗Ра┐Ра┐РаІРађРб╗РБ┐РАёРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРаЎРбЙРБєРаѕРБи
РАЪРађРА┐РаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРБ┤РБХРБцРАђРбИРБ┐РаЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРб╗РАёРб╣
РАЄРађРаЃРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРАЄРађРаѕРБ┐РБ╝РАЪРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРаЃРбИ
РбАРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРа╗РаХРБХРАЪРаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРА╝
РаѕРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбђРАЙРаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаЂ
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРАЂРбаРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
  
­Ъџђ Server running on port ${PORT} ­Ъџђ`)
}

bootstrap()
